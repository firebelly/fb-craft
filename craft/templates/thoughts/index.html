{% extends (craft.request.isAjax and not craft.request.isLivePreview) ? "_ajax-layout" : "_layout" %}
{% set title = "Thoughts" %}

{% if tag is defined %}
  {% set tag = craft.tags.slug(tag).first() %}
  {% set thoughtEntries = craft.entries({
    section: 'thoughts',
    relatedTo: tag,
    with: [
      'headerImage'
    ]
  }) %}
{% else %}
  {% set thoughtEntries = craft.entries({
    section: 'thoughts',
    with: [
      'headerImage'
    ]
  }) %}
{% endif %}

{% block content %}
  {% cache unless currentUser %}
	<section class="thoughts-list page-content" data-page="/thoughts" data-page-title="{{ title }}">
    {% if tag is defined %}
      <div class="filter-header active"><div class="filter-header-wrap">Filter:<p><span class="filter">{{ tag.title }}</span> <a href="/thoughts" class="tcon tcon-no-animate tcon-menu--xcross xcross-open xcross-small" aria-label="remove tag filter"><span class="tcon-menu__lines" aria-hidden="true"></span><span class="tcon-visuallyhidden">remove tag filter</span></a></p></div></div>
    {% endif %}

		{% for entry in thoughtEntries %}
			{% include "thoughts/_article" %}
		{% endfor %}
	</section>
	{% endcache %}
{% endblock %}

{% block aside %}
  {% cache globally using key "thoughts-nav" %}
    {% include "partials/_thoughts_nav" %}
  {% endcache %}
{% endblock aside %}
